<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Editar Reserva</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container py-4">
        <h1 class="mb-3">Editar Reserva</h1>

        <% if (typeof errors !== 'undefined' && errors && errors.length) { %>
            <div class="alert alert-danger">
                <ul class="mb-0">
                    <% errors.forEach(function(err){ %>
                        <li><%= err.msg || err %></li>
                    <% }) %>
                </ul>
            </div>
        <% } %>

        <!-- Ajuste a action conforme sua rota e middleware de method-override -->
        <form method="post" action="/reserva/<%= reserva && reserva.id ? reserva.id : '' %>?_method=PUT" class="row g-3">
            <div class="col-md-6">
                <label for="nome" class="form-label">Nome</label>
                <input id="nome" name="nome" type="text" class="form-control" required
                             value="<%= reserva ? reserva.nome : '' %>" placeholder="Nome do hóspede">
            </div>

            <div class="col-md-6">
                <label for="email" class="form-label">E-mail</label>
                <input id="email" name="email" type="email" class="form-control"
                             value="<%= reserva ? reserva.email : '' %>" placeholder="exemplo@dominio.com">
            </div>

            <div class="col-md-4">
                <label for="telefone" class="form-label">Telefone</label>
                <input id="telefone" name="telefone" type="tel" class="form-control"
                             value="<%= reserva ? reserva.telefone : '' %>" placeholder="(xx) xxxxx-xxxx">
            </div>

            <div class="col-md-4">
                <label for="dataEntrada" class="form-label">Data de Entrada</label>
                <input id="dataEntrada" name="dataEntrada" type="date" class="form-control" required
                             value="<%= reserva ? (reserva.dataEntrada ? reserva.dataEntrada.split('T')[0] : '') : '' %>">
            </div>

            <div class="col-md-4">
                <label for="dataSaida" class="form-label">Data de Saída</label>
                <input id="dataSaida" name="dataSaida" type="date" class="form-control" required
                             value="<%= reserva ? (reserva.dataSaida ? reserva.dataSaida.split('T')[0] : '') : '' %>">
            </div>

            <div class="col-md-3">
                <label for="adultos" class="form-label">Adultos</label>
                <input id="adultos" name="adultos" type="number" min="1" class="form-control"
                             value="<%= reserva ? reserva.adultos : 1 %>">
            </div>

            <div class="col-md-3">
                <label for="criancas" class="form-label">Crianças</label>
                <input id="criancas" name="criancas" type="number" min="0" class="form-control"
                             value="<%= reserva ? reserva.criancas : 0 %>">
            </div>

            <div class="col-md-6">
                <label for="quarto" class="form-label">Quarto</label>
                <select id="quarto" name="quartoId" class="form-select" required>
                    <option value="">Selecione um quarto</option>
                    <% if (typeof quartos !== 'undefined' && quartos && quartos.length) { %>
                        <% quartos.forEach(function(q) { %>
                            <option value="<%= q.id %>" <%= reserva && String(reserva.quartoId) === String(q.id) ? 'selected' : '' %>>
                                <%= q.nome %> - <%= q.descricao ? q.descricao : '' %>
                            </option>
                        <% }) %>
                    <% } else { %>
                        <option value="">Nenhum quarto disponível</option>
                    <% } %>
                </select>
            </div>

            <div class="col-md-6">
                <label for="status" class="form-label">Status</label>
                <select id="status" name="status" class="form-select">
                    <option value="pendente" <%= reserva && reserva.status === 'pendente' ? 'selected' : '' %>>Pendente</option>
                    <option value="confirmada" <%= reserva && reserva.status === 'confirmada' ? 'selected' : '' %>>Confirmada</option>
                    <option value="cancelada" <%= reserva && reserva.status === 'cancelada' ? 'selected' : '' %>>Cancelada</option>
                </select>
            </div>

            <div class="col-12">
                <label for="observacoes" class="form-label">Observações</label>
                <textarea id="observacoes" name="observacoes" rows="3" class="form-control" placeholder="Observações adicionais"><%= reserva ? reserva.observacoes : '' %></textarea>
            </div>

            <div class="col-12 d-flex gap-2">
                <button type="submit" class="btn btn-primary">Salvar</button>
                <a href="/reserva" class="btn btn-outline-secondary">Cancelar</a>
                <% if (reserva && reserva.id) { %>
                    <form method="post" action="/reserva/<%= reserva.id %>?_method=DELETE" class="ms-auto" onsubmit="return confirm('Deseja realmente excluir esta reserva?');">
                        <button type="submit" class="btn btn-danger">Excluir</button>
                    </form>
                <% } %>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html></div>