<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Lista de Clientes</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container py-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="h4 mb-0">Clientes</h1>
            <a href="/cliente/novo" class="btn btn-primary">Novo Cliente</a>
        </div>

        <form class="row g-2 mb-3" method="get" action="">
            <div class="col-auto flex-grow-1">
                <input type="search" name="q" value="<%= typeof q !== 'undefined' ? q : '' %>" class="form-control" placeholder="Pesquisar por nome, e-mail ou telefone">
            </div>
            <div class="col-auto">
                <button class="btn btn-outline-secondary" type="submit">Pesquisar</button>
                <a href="/cliente" class="btn btn-outline-secondary">Limpar</a>
            </div>
        </form>

        <% if (!clientes || clientes.length === 0) { %>
            <div class="alert alert-info">Nenhum cliente encontrado.</div>
        <% } else { %>
            <div class="table-responsive">
                <table class="table table-sm table-striped align-middle">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nome</th>
                            <th>E-mail</th>
                            <th>Telefone</th>
                            <th>Cadastro</th>
                            <th class="text-end">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% clientes.forEach(function(c, i) { %>
                            <tr>
                                <td><%= c.id || (i + 1) %></td>
                                <td><%= c.nome || '-' %></td>
                                <td><%= c.email || '-' %></td>
                                <td><%= c.telefone || '-' %></td>
                                <td><%= c.criadoEm ? new Date(c.criadoEm).toLocaleDateString('pt-BR') : '-' %></td>
                                <td class="text-end">
                                    <a href="/cliente/editar/<%= c.id %>" class="btn btn-sm btn-outline-primary me-1">Editar</a>
                                    <form action="/cliente/excluir/<%= c.id %>" method="post" style="display:inline" onsubmit="return confirm('Confirma exclusão do cliente <%= (c.nome||'este cliente') %>?');">
                                        <button type="submit" class="btn btn-sm btn-outline-danger">Excluir</button>
                                    </form>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>

            <% if (typeof pagination !== 'undefined' && pagination.totalPages > 1) { %>
                <nav aria-label="Paginação">
                    <ul class="pagination">
                        <% for (let p = 1; p <= pagination.totalPages; p++) { %>
                            <li class="page-item <%= p === pagination.page ? 'active' : '' %>">
                                <a class="page-link" href="?q=<%= encodeURIComponent(typeof q !== 'undefined' ? q : '') %>&page=<%= p %>"><%= p %></a>
                            </li>
                        <% } %>
                    </ul>
                </nav>
            <% } %>
        <% } %>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>