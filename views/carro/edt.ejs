<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Editar Carro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container py-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="h3">Editar Carro</h1>
            <a href="/carro" class="btn btn-secondary">Voltar</a>
        </div>

        <% if (typeof errors !== 'undefined' && errors && errors.length) { %>
            <div class="alert alert-danger">
                <strong>Corrija os erros abaixo:</strong>
                <ul class="mb-0">
                    <% errors.forEach(function(err){ %>
                        <li><%= err.msg || err %></li>
                    <% }) %>
                </ul>
            </div>
        <% } %>

        <form action="/carro/<%= carro && carro._id ? carro._id : '' %>?_method=PUT" method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="marca" class="form-label">Marca</label>
                    <input id="marca" name="marca" type="text" class="form-control" 
                        value="<%= carro?.marca || '' %>" required>
                </div>

                <div class="col-md-6">
                    <label for="modelo" class="form-label">Modelo</label>
                    <input id="modelo" name="modelo" type="text" class="form-control" 
                        value="<%= carro?.modelo || '' %>" required>
                </div>

                <div class="col-md-4">
                    <label for="ano" class="form-label">Ano</label>
                    <input id="ano" name="ano" type="number" min="1886" max="2100" class="form-control" 
                        value="<%= carro?.ano || '' %>">
                </div>

                <div class="col-md-4">
                    <label for="placa" class="form-label">Placa</label>
                    <input id="placa" name="placa" type="text" class="form-control" 
                        value="<%= carro?.placa || '' %>" required>
                </div>

                <div class="col-md-4">
                    <label for="diaria" class="form-label">Diária (R$)</label>
                    <input id="diaria" name="diaria" type="number" step="0.01" min="0" class="form-control" 
                        value="<%= carro?.diaria || '' %>" required>
                </div>

                <div class="col-md-6">
                    <label for="imagem" class="form-label">Imagem (opcional)</label>
                    <input id="imagem" name="imagem" type="file" accept="image/*" class="form-control">
                    <% if (carro?.imagem && carro?.imagemTipo) { %>
                        <div class="mt-2">
                            <img src="data:<%= carro.imagemTipo %>;base64,<%= carro.imagem.toString('base64') %>" 
                                 alt="Imagem atual" class="img-thumbnail" style="max-width: 200px;">
                        </div>
                    <% } %>
                </div>

                <div class="col-md-6">
                    <label for="disponivel" class="form-label">Disponibilidade</label>
                    <select id="disponivel" name="disponivel" class="form-select">
                        <option value="true" <%= carro?.disponivel ? 'selected' : '' %>>Disponível</option>
                        <option value="false" <%= carro && carro.disponivel === false ? 'selected' : '' %>>Indisponível</option>
                    </select>
                </div>

                <div class="col-12 d-flex gap-2">
                    <button type="submit" class="btn btn-primary">Salvar</button>
                    <a href="/carro" class="btn btn-outline-secondary">Cancelar</a>
                </div>
            </div>
        </form>
    </div>

    <script>
        // Validação bootstrap simples
        (function () {
            'use strict'
            const forms = document.querySelectorAll('.needs-validation')
            Array.prototype.slice.call(forms).forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }
                    form.classList.add('was-validated')
                }, false)
            })
        })()
    </script>
</body>
</html>
